# ローカル開発について
ローカル開発はFirebase Local Emulator Suiteでぜんぶ回せる。  
Auth（Googleログイン含む）/ Firestore / Storage / Functions / Hostingを
ローカルに立ててアプリはそれに接続するのが基本  

### エミュレータ
1.エミュレータ起動
```
npm i -g firebase-tools
firebase init emulators   # 使うものを選ぶ（Auth/Firestore/Storage/Functions/Hosting）
firebase emulators:start
```
デフォルトのポートは例：UI=4000 / Auth=9099 / Firestore=8080 / Storage=9199 / Functions=5001。変えたいなら firebase.json で設定できる。  

2.アプリからローカルへ接続（Web/TypeScript）
```
import { initializeApp } from "firebase/app";
import { getAuth, connectAuthEmulator } from "firebase/auth";
import { getFirestore, connectFirestoreEmulator } from "firebase/firestore";
import { getStorage, connectStorageEmulator } from "firebase/storage";
import { getFunctions, connectFunctionsEmulator } from "firebase/functions";

const app = initializeApp({ /* 本来のfirebaseConfig */ });

const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);
const functions = getFunctions(app);

// 開発時だけエミュレータへ
if (location.hostname === "localhost") {
  connectAuthEmulator(auth, "http://127.0.0.1:9099");
  connectFirestoreEmulator(db, "127.0.0.1", 8080);
  connectStorageEmulator(storage, "127.0.0.1", 9199);
  connectFunctionsEmulator(functions, "127.0.0.1", 5001);
}
```
それぞれの connect*Emulator は公式が推奨するやり方。  

###   Google認証はどうなる？」（ローカル）  

<ul>

<li>Auth エミュレータはGoogleなどのサードパーティ認証のフローを模擬できる。Web だと signInWithPopup/Redirect がエミュレータ提供のローカルなサインイン画面に遷移し、実在のGoogleアカウントを使わずにテスト可能。</li>


<li>エミュレータのIDトークンは署名なしで、他のエミュレータ or Admin SDK（エミュレータモード）だけが受理する点に注意（本番サービスでは拒否される）。</li>
</ul>

### 「phpMyAdmin みたいなやつある？」
<ul>
<li>ある（ローカル）：Emulator UI。ブラウザで http://localhost:4000 を開くと、Firestore のデータを閲覧/編集できる。
Firestore データ画面へは localhost:4000/firestore/default/data 直アクセスも可。Rulesの評価トレース（Requestsタブ）やカバレッジレポートも見られる。</li>
<li>
本番：Firebase コンソールの Firestore / Authentication 画面が“phpMyAdmin 的”な役割。エミュレータを使わずに接続すれば、本番リソースに直で当たる（ただし基本はローカル分離がおすすめ）
</li>
</ul>

### ローカル or 本番、どっちに繋ぐ？
<ul>
<li>エミュレータ優先：安全・速い・無料。未エミュレートのサービスだけ本番に当たる挙動も可能だが、今回の構成は全部ローカル化できる</li>

<li>データの保存/再利用：エミュレータは起動終了で消える。固定データが必要ならインポート/エクスポートでシードできる 
</li>
</ul>

```
firebase emulators:export ./seed && firebase emulators:start --import=./seed --export-on-exit
```
### セットアップ手順
1.firebase init → プロジェクトとエミュレータ選択  
2.firebase emulators:start → Emulator UI(4000) を開く  
3.アプリで connect*Emulator を仕込む（↑コード）  
4.UIの Authenticationタブ でテストユーザー作成 or Google模擬サインイン  
5.Firestoreタブ でコレクション/ドキュメントを目視・編集、Requestsで Rules も追跡  


