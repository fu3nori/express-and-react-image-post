rules_version = '2';
service firebase.storage {
    match /b/{bucket}/o {
        function isSignedIn() { return request.auth != null; }
        function isOwner(uid) { return isSignedIn() && request.auth.uid == uid; }

        // プロフィール画像（公開読み取り・本人のみ書き込み）
        match /users/{uid}/{fileName} {
            allow read: if true;
            allow write: if isOwner(uid)
                && request.resource.size < 5 * 1024 * 1024
                && request.resource.contentType.matches('image/(jpeg|png)');
        }

        // 作品（original/view_1280/thumb_500 想定：公開読み取り・本人のみ書き込み）
        match /artworks/{uid}/{artId}/{fileName} {
            allow read: if true;
            allow write: if isOwner(uid)
                && request.resource.size < 10 * 1024 * 1024
                && request.resource.contentType.matches('image/(jpeg|png)');
        }

        // （任意・互換）旧 posts パスも許可
        match /posts/{uid}/{postId}/{fileName} {
            allow read: if true;
            allow write: if isOwner(uid)
                && request.resource.size < 10 * 1024 * 1024
                && request.resource.contentType.matches('image/(jpeg|png)');
        }
    }
}
