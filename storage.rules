rules_version = '2';
service firebase.storage {
    match /b/{bucket}/o {
        function isSignedIn() { return request.auth != null; }

        // users/{uid}/... は本人のみ書き込み許可。読み取りは公開。
        match /users/{uid}/{file} {
            allow read: if true;
            allow write: if isSignedIn() && request.auth.uid == uid;
        }

        // 作品用（予定）
        match /posts/{uid}/{postId}/{file} {
            allow read: if true;
            allow write: if isSignedIn() && request.auth.uid == uid;
        }

        // プロフィール画像
        match /users/{uid}/{file} {
            allow read: if true;
            allow write: if isSignedIn() && request.auth.uid == uid
                && request.resource.size < 10 * 1024 * 1024
                && (request.resource.contentType == "image/jpeg" || request.resource.contentType == "image/png");
        }

        // 作品：original / view_1280 / thumb_500
        match /artworks/{uid}/{artId}/{name} {
            allow read: if true;
            allow write: if isSignedIn() && request.auth.uid == uid
                && request.resource.size < 10 * 1024 * 1024
                && (request.resource.contentType == "image/jpeg" || request.resource.contentType == "image/png");
        }
    }
}
